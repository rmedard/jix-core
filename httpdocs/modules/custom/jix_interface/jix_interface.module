<?php
/**
 * @file
 * A description of what your module does.
 */

use Drupal\Core\Entity\EntityInterface;
use Drupal\node\NodeInterface;
use Drupal\smart_ip\SmartIpLocation;

/**
 * Implements hook_theme().
 * @param $existing
 * @param $type
 * @param $theme
 * @param $path
 * @return array
 */
function jix_interface_theme($existing, $type, $theme, $path)
{
  return [
    'jix_upload_cv' => [
      'variables' => [
        'label' => ''
      ]
    ],
    'jix_job_summary' => [
      'variables' => [
        'job' => [],
        'viewsCount' => 0
      ]
    ],
    'jix_job_employer' => [
      'variables' => [
        'employer' => [],
        'pageNodeBundle' => ''
      ]
    ],
    'jix_posting_plans_page' => [
      'variables' => [
        'plans' => [],
        'header_text' => '',
        'footer_text' => ''
      ]
    ]
  ];
}

/**
 * Implements hook_ENTITY_TYPE_presave().
 * @param EntityInterface $entity
 */
function jix_interface_node_presave(EntityInterface $entity)
{
  if ($entity instanceof NodeInterface and $entity->bundle() == 'job') {
    if ($entity->isNew()) {
      $locationObj = Drupal::service('smart_ip.smart_ip_location');
      Drupal::messenger()->addWarning('Country: ' . $locationObj->get('countryCode'));
      $location = $locationObj->get('city') . ', ' . $locationObj->get('country') . '(' . $locationObj->get('countryCode') . ')';
      $entity->set('field_job_creator_location', $location);
    }
  }
}
